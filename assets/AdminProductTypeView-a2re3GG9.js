import{N as B,S as E,V as L,o as i,c as o,X as x,a as e,i as b,G as j,H as g,F as C,D as R,$ as u,w,Z as z,a1 as m,a2 as A,b as U,a5 as T}from"./index-Be_OT17-.js";import{u as G,C as H}from"./CrudModal-DE3E-C2e.js";const X={key:0,class:"section has-text-centered"},Z={class:"buttons"},q=["disabled"],J=["disabled"],K={class:"columns"},Q={class:"column"},W={class:"field"},Y={class:"control"},ee={key:0,class:"help is-danger"},se={class:"field"},te={class:"control"},le={class:"checkbox",for:"isOpen"},ae={class:"column"},ne={class:"field"},ie={class:"file has-name"},oe={class:"file-label"},ue={class:"file-name"},de={key:0,class:"mt-3"},ce={class:"image is-256x256 is-inline-block",style:{border:"1px solid #dbdbdb",padding:"5px"}},re=["src"],ve={class:"table is-fullwidth"},me={class:"is-vcentered"},pe={class:"is-vcentered has-text-weight-medium"},fe={class:"is-vcentered"},_e={key:0,class:"image is-64x64"},he=["src"],be={key:1,class:"has-text-grey-light is-size-7"},ge={class:"is-vcentered"},ye={class:"is-vcentered"},ke={class:"buttons"},xe=["onClick"],Ce=["onClick"],Ve={__name:"AdminProductTypeView",setup(we){const d=G(),{productTypes:V,isLoading:O}=B(d),p=u(!1),r=u({name:"",isOpen:!0}),a=u({name:"",isOpen:!0}),f=u(!1),_=u(null),v=u(!1),n=u(null),c=u("");let h=null;E(()=>{h=d.fetchProductTypes()}),L(()=>{h&&h()});const P=l=>{f.value=!0,_.value=l.id,a.value={...l},c.value=l.imageUrl||"",n.value=null,p.value=!0},I=async()=>{if(N()&&!v.value){v.value=!0;try{let l=a.value.imageUrl||"";n.value&&(l=await d.uploadImage(n.value));const s={...a.value,imageUrl:l};f.value?await d.updateProductType(_.value,s):await d.addProductType(s),y(),n.value=null,c.value="",alert("儲存成功！")}catch(l){alert("操作失敗",l)}finally{v.value=!1}}},M=async(l,s)=>{if(confirm(`確定要刪除「${s}」這個分類嗎？此動作無法復原。`)){console.log("Store delete function:",d.deleteProductType);try{await d.deleteProductType(l),alert("已成功刪除")}catch(t){alert("刪除失敗，請稍後再試",t)}}},y=()=>{p.value=!1,f.value=!1,_.value=null,a.value={name:"",isOpen:!0},r.value={name:""},n.value=null,c.value=""},S=()=>{y()},D=l=>{const s=l.target.files[0];s&&(n.value=s,c.value=URL.createObjectURL(s))},F=()=>{n.value=null,c.value="";const l=document.getElementById("imageInput");l&&(l.value=""),a.value.imageUrl=""},N=()=>(r.value={name:"",isOpen:!0},a.value.name||(r.value.name="請輸入作品類型"),!r.value.name);return(l,s)=>(i(),o(C,null,[x(O)?(i(),o("div",X,[...s[4]||(s[4]=[e("button",{class:"button is-loading is-large is-white"},null,-1)])])):b("",!0),e("div",null,[s[9]||(s[9]=e("p",{class:"subtitle has-text-centered"},"產品類別維護",-1)),e("button",{class:"button is-info",onClick:s[0]||(s[0]=t=>(f.value=!1,p.value=!0))}," 新增產品類別 "),j(H,{modelValue:p.value,"onUpdate:modelValue":s[3]||(s[3]=t=>p.value=t)},{header:g(()=>[U(m(f.value?"修改產品類型":"建立產品類型"),1)]),footer:g(()=>[e("div",Z,[e("button",{class:T(["button is-success",{"is-loading":v.value}]),disabled:v.value,onClick:I}," 確認 ",10,q),e("button",{class:"button is-danger",disabled:v.value,onClick:S},"取消",8,J)])]),default:g(()=>[e("div",K,[e("div",Q,[e("div",W,[s[5]||(s[5]=e("label",{for:"name",class:"label"},"類型名稱",-1)),e("div",Y,[w(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.name=t),id:"name",class:"input",type:"text",placeholder:"Text input"},null,512),[[z,a.value.name]])]),r.value.name?(i(),o("span",ee,m(r.value.name),1)):b("",!0)]),e("div",se,[e("div",te,[e("label",le,[w(e("input",{id:"isOpen","onUpdate:modelValue":s[2]||(s[2]=t=>a.value.isOpen=t),type:"checkbox"},null,512),[[A,a.value.isOpen]]),s[6]||(s[6]=U(" 啟用 ",-1))])])])]),e("div",ae,[e("div",ne,[e("div",ie,[e("label",oe,[e("input",{class:"file-input",type:"file",name:"resume",id:"imageInput",accept:"image/*",onChange:D},null,32),s[7]||(s[7]=e("span",{class:"file-cta"},[e("span",{class:"file-icon"},[e("i",{class:"fas fa-upload"})]),e("span",{class:"file-label"}," 圖片 ")],-1)),e("span",ue,m(n.value?n.value.name:"請上傳圖片....."),1)])]),c.value?(i(),o("div",de,[e("figure",ce,[e("img",{src:c.value,style:{"object-fit":"cover",height:"100%"}},null,8,re)]),e("div",{class:"mt-1"},[e("button",{class:"button is-small is-danger is-light",onClick:F}," 移除圖片 ")])])):b("",!0)])])])]),_:1},8,["modelValue"]),s[10]||(s[10]=e("hr",null,null,-1)),e("table",ve,[s[8]||(s[8]=e("thead",null,[e("tr",null,[e("th",null,"index"),e("th",null,"名稱"),e("th",null,"img"),e("th",null,"狀態"),e("th",null,"功能")])],-1)),e("tbody",null,[(i(!0),o(C,null,R(x(V),(t,k)=>(i(),o("tr",{key:k},[e("td",me,m(k+1),1),e("td",pe,m(t.name),1),e("td",fe,[t.imageUrl?(i(),o("figure",_e,[e("img",{src:t.imageUrl,alt:"類別圖片",style:{"object-fit":"cover",height:"100%",width:"100%","border-radius":"4px"}},null,8,he)])):(i(),o("span",be,"無圖片"))]),e("td",ge,[e("span",{class:T(["tag",t.isOpen?"is-success is-light":"is-danger is-light"])},m(t.isOpen?"開啟":"關閉"),3)]),e("td",ye,[e("div",ke,[e("button",{type:"button",class:"button is-small is-success",onClick:$=>P(t)}," 修改 ",8,xe),e("button",{type:"button",class:"button is-small is-danger",onClick:$=>M(t.id,t.name)}," 刪除 ",8,Ce)])])]))),128))])])])],64))}};export{Ve as default};
